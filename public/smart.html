<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>スマホ操作画面</title>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <h2>スマホの傾き送信</h2>
  <button id="startBtn">傾き送信を開始</button>
  <p id="status">待機中...</p>

  <script>
    const socket = io();
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');

    startBtn.addEventListener('click', async () => {
      statusEl.textContent = "許可をリクエスト中...";

      // iOS Safariなどで必要な許可処理
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        try {
          const response = await DeviceOrientationEvent.requestPermission();
          if (response !== 'granted') {
            alert('傾きセンサーの使用が許可されませんでした');
            return;
          }
        } catch (e) {
          alert('エラー: ' + e);
          return;
        }
      }

      statusEl.textContent = "傾きデータ送信中...";
      window.addEventListener('deviceorientation', (event) => {
        const data = {
          alpha: event.alpha,
          beta: event.beta,
          gamma: event.gamma
        };
        socket.emit('tiltData', data);
        statusEl.textContent = `送信中: β=${data.beta.toFixed(1)}, γ=${data.gamma.toFixed(1)}`;
      });
    });
  </script>
</body>
</html>
