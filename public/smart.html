<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>スマホ送信側</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js"></script>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      text-align: center;
      margin-top: 100px;
    }
    button {
      padding: 10px 20px;
      font-size: 20px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>スマホの傾き送信ページ</h2>
  <p>「許可して送信開始」を押すと、傾きデータを送ります。</p>
  <button id="startBtn">許可して送信開始</button>

  <script>
    const socket = io();

    const btn = document.getElementById("startBtn");
    btn.addEventListener("click", async () => {
      if (typeof DeviceOrientationEvent.requestPermission === "function") {
        try {
          const permission = await DeviceOrientationEvent.requestPermission();
          if (permission === "granted") {
            startSending();
          } else {
            alert("傾きセンサーの許可が必要です。");
          }
        } catch (e) {
          alert("センサー許可エラー: " + e);
        }
      } else {
        // Androidなどは直接開始できる
        startSending();
      }
    });

    function startSending() {
      btn.disabled = true;
      btn.innerText = "送信中...";
      window.addEventListener("deviceorientation", (event) => {
        const g = event.gamma || 0; // 左右
        const b = event.beta || 0;  // 前後
        socket.emit("sensor", { g, b });
      });
    }
  </script>
</body>
</html>
